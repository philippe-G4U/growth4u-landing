---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Footer from '../../components/Footer.astro';
import CookieBanner from '../../react/CookieBanner';
import { getTranslations } from '../../i18n/utils';
import { getAllCaseStudies } from '../../lib/firebase-fetch';
import { BOOKING_LINK } from '../../lib/constants';

const t = getTranslations('es');

let caseStudies: Awaited<ReturnType<typeof getAllCaseStudies>> = [];
try {
  caseStudies = await getAllCaseStudies();
} catch (e) {
  console.warn('Could not fetch case studies at build time:', e);
}
---

<BaseLayout
  title="Casos de Éxito | Growth4U"
  description="Resultados auditados de Growth Marketing para Empresas Tech B2B y B2C. Descubre cómo ayudamos a nuestros clientes a escalar."
>
  <CookieBanner client:idle />

  <!-- Floating Nav -->
  <div class="fixed top-6 inset-x-0 z-50 flex justify-center px-4">
    <nav class="nav-island w-full max-w-6xl">
      <div class="px-6 sm:px-8">
        <div class="flex items-center justify-between h-16">
          <a href="/" class="flex items-center gap-0 cursor-pointer group flex-shrink-0">
            <img src="https://i.imgur.com/imHxGWI.png" alt="Growth4U Logo" width="133" height="20" class="h-5 md:h-6 w-auto object-contain transition-transform group-hover:scale-105" />
          </a>
          <div class="hidden md:flex items-center gap-6">
            <a href="/" class="hover:text-[#6351d5] transition-colors px-2 py-2 rounded-md text-sm font-medium text-[#032149]">Home</a>
            <a href="/blog/" class="hover:text-[#6351d5] transition-colors px-2 py-2 rounded-md text-sm font-medium text-[#032149]">Blog</a>
            <span class="text-[#6351d5] px-2 py-2 rounded-md text-sm font-bold">Casos de Éxito</span>
          </div>
          <div class="flex items-center gap-4">
            <a href={BOOKING_LINK} target="_blank" rel="noopener noreferrer" class="bg-[#6351d5] hover:bg-[#3f45fe] text-white font-bold py-2 px-5 rounded-full text-sm transition-all duration-300 shadow-lg">
              {t.nav.cta}
            </a>
          </div>
        </div>
      </div>
    </nav>
  </div>

  <!-- Hero Section -->
  <section class="pt-40 pb-20 px-4">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#6351d5]/10 text-[#6351d5] font-bold text-sm mb-4">
          <!-- Trophy SVG -->
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
          RESULTADOS AUDITADOS
        </span>
        <h1 class="text-4xl md:text-6xl font-extrabold text-[#032149] mb-6">
          Casos de <span class="text-[#6351d5]">Éxito</span>
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto">
          Resultados reales de empresas que confiaron en Growth4U para escalar su crecimiento.
        </p>
      </div>

      <!-- Case Studies Grid -->
      {caseStudies.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {caseStudies.map((caseStudy) => (
            <a
              href={`/casos-de-exito/${caseStudy.slug}/`}
              class="bg-white rounded-2xl overflow-hidden border border-slate-100 shadow-sm hover:shadow-xl transition-all duration-300 group cursor-pointer hover:-translate-y-1"
            >
              <!-- Image or Gradient Fallback -->
              <div class="relative aspect-video overflow-hidden">
                {caseStudy.image ? (
                  <img
                    src={caseStudy.image}
                    alt={caseStudy.company}
                    class="object-cover w-full h-full transform group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                ) : (
                  <div class="w-full h-full bg-gradient-to-br from-[#6351d5] to-[#3f45fe] flex items-center justify-center">
                    <span class="text-white text-2xl font-bold opacity-80">{caseStudy.company}</span>
                  </div>
                )}
                <!-- Stat Badge -->
                {caseStudy.stat && (
                  <div class="absolute top-4 right-4 bg-white/95 backdrop-blur px-3 py-1.5 rounded-full text-sm font-black text-[#6351d5] border border-slate-200 shadow-sm">
                    {caseStudy.stat}
                  </div>
                )}
                <!-- Company Badge -->
                <div class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-[#032149] uppercase tracking-wide border border-slate-200 shadow-sm">
                  {caseStudy.company}
                </div>
              </div>

              <!-- Content -->
              <div class="p-6">
                {caseStudy.highlight && (
                  <p class="text-sm text-[#6351d5] font-semibold italic mb-3 line-clamp-2">
                    &ldquo;{caseStudy.highlight}&rdquo;
                  </p>
                )}
                <p class="text-slate-600 text-sm mb-3 line-clamp-3 leading-relaxed">
                  {caseStudy.summary}
                </p>
                {caseStudy.challenge && (
                  <p class="text-slate-500 text-xs mb-4 line-clamp-2">
                    <span class="font-bold text-red-500">Reto:</span> {caseStudy.challenge}
                  </p>
                )}
                <div class="flex items-center justify-between text-sm pt-4 border-t border-slate-50">
                  <span class="text-slate-400 text-xs flex items-center gap-1">
                    <!-- TrendingUp SVG -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3.5 h-3.5"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                    Caso verificado
                  </span>
                  <span class="text-[#6351d5] font-bold flex items-center gap-1 group-hover:gap-2 transition-all">
                    Ver caso
                    <!-- ArrowRight SVG -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                  </span>
                </div>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <!-- Empty State -->
        <div class="text-center py-20">
          <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6351d5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
          </div>
          <h3 class="text-2xl font-bold text-[#032149] mb-3">Próximamente</h3>
          <p class="text-slate-600 max-w-md mx-auto">
            Estamos preparando nuestros casos de éxito. Vuelve pronto para descubrir cómo ayudamos a empresas tech a escalar.
          </p>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-24 px-4">
    <div class="max-w-4xl mx-auto">
      <div class="bg-gradient-to-br from-[#6351d5] to-[#3f45fe] rounded-3xl p-12 md:p-16 text-center text-white relative overflow-hidden">
        <!-- Decorative circles -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"></div>

        <div class="relative">
          <h2 class="text-3xl md:text-4xl font-extrabold mb-4">
            ¿Quieres ser el próximo caso de éxito?
          </h2>
          <p class="text-white/80 text-lg mb-8 max-w-xl mx-auto">
            Agenda una llamada y descubre cómo podemos ayudarte a escalar tu empresa tech con resultados medibles.
          </p>
          <a
            href={BOOKING_LINK}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center gap-2 bg-white text-[#6351d5] font-bold py-4 px-8 rounded-full text-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105"
          >
            Agendar Llamada Gratis
            <!-- ArrowRight SVG -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer t={t} bookingLink={BOOKING_LINK} />
</BaseLayout>
