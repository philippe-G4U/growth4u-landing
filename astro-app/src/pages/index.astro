---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/Navbar.astro';
import HeroSection from '../components/HeroSection.astro';
import ProblemSection from '../components/ProblemSection.astro';
import ResultsSection from '../components/ResultsSection.astro';
import MethodologySection from '../components/MethodologySection.astro';
import CaseStudies from '../components/CaseStudies.astro';
import TeamSection from '../components/TeamSection.astro';
import BlogPreviewSection from '../components/BlogPreviewSection.astro';
import Footer from '../components/Footer.astro';
import CookieBanner from '../react/CookieBanner';
import { getTranslations } from '../i18n/utils';
import { getAllPosts } from '../lib/firebase-fetch';
import { BOOKING_LINK, SITE_URL } from '../lib/constants';

const t = getTranslations('es');

// Fetch blog posts at build time via REST API (zero JS shipped)
let posts: Awaited<ReturnType<typeof getAllPosts>> = [];
try {
  posts = await getAllPosts();
} catch (e) {
  console.warn('Could not fetch blog posts at build time:', e);
}

// ProfessionalService schema for SEO
const professionalServiceSchema = {
  '@context': 'https://schema.org',
  '@type': 'ProfessionalService',
  name: 'Growth4U',
  description: 'Especialistas en Growth Marketing para Fintech B2B y B2C. Creamos motores de crecimiento basados en confianza que reducen el CAC y aumentan el LTV.',
  url: SITE_URL,
  areaServed: [
    { '@type': 'Country', name: 'Spain' },
    { '@type': 'Country', name: 'Portugal' },
    { '@type': 'GeoCircle', geoMidpoint: { '@type': 'GeoCoordinates', latitude: 40.4168, longitude: -3.7038 }, geoRadius: '2000 km' }
  ],
  serviceType: ['Growth Marketing', 'Growth Hacking', 'Customer Acquisition', 'Trust Engine'],
  knowsAbout: ['Fintech', 'B2B SaaS', 'B2C Finance', 'Neobanking', 'Crypto', 'Payments'],
};

// FAQPage schema
const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: '¿Qué es el Trust Engine de Growth4U?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'El Trust Engine es nuestra metodología propietaria que construye motores de crecimiento basados en confianza. Sustituye el gasto publicitario inflado por sistemas de confianza orgánica y viralidad estructurada, reduciendo el CAC hasta un 70%.'
      }
    },
    {
      '@type': 'Question',
      name: '¿En qué etapa de crecimiento me podéis ayudar?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Ayudamos fintechs en 3 etapas: Buscando PMF (0 a tracción real), Escalando (10K a 500K usuarios), y Expansión (nuevo mercado o producto). Cada etapa tiene su propia estrategia y garantías.'
      }
    },
    {
      '@type': 'Question',
      name: '¿Qué resultados puedo esperar?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Nuestros clientes han logrado resultados como 500K usuarios activos en 30 meses (BNEXT), reducción del 70% en CAC (BIT2ME), y 10K€ MRR en 6 meses desde el lanzamiento (GoCardless).'
      }
    }
  ]
};
---

<BaseLayout
  title="Growth4U | Growth Marketing Fintech B2B & B2C"
  description="Especialistas en Growth Fintech. Te ayudamos a crear un motor de crecimiento que perdura en el tiempo y reduce tu CAC apoyándonos en el valor de la confianza."
  jsonLd={[professionalServiceSchema, faqSchema]}
>
  <Navbar t={t} lang="es" bookingLink={BOOKING_LINK} />
  <HeroSection t={t} bookingLink={BOOKING_LINK} />
  <ProblemSection t={t} />
  <ResultsSection t={t} />
  <MethodologySection t={t} />
  <CaseStudies t={t} cases={t.cases.list} />
  <TeamSection t={t} />
  <BlogPreviewSection t={t} posts={posts} />
  <Footer t={t} bookingLink={BOOKING_LINK} />
  <CookieBanner client:idle />
</BaseLayout>
