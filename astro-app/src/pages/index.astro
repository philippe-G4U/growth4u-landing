---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/Navbar.astro';
import HeroSection from '../components/HeroSection.astro';
import ProblemSection from '../components/ProblemSection.astro';
import ResultsSection from '../components/ResultsSection.astro';
import MethodologySection from '../components/MethodologySection.astro';
import CaseStudies from '../components/CaseStudies.astro';
import TeamSection from '../components/TeamSection.astro';
import BlogPreviewSection from '../components/BlogPreviewSection.astro';
import Footer from '../components/Footer.astro';
import CookieBanner from '../react/CookieBanner';
import { getTranslations } from '../i18n/utils';
import { getAllPosts } from '../lib/firebase-fetch';
import { BOOKING_LINK, SITE_URL } from '../lib/constants';

const t = getTranslations('es');

// Fetch blog posts at build time via REST API (zero JS shipped)
let posts: Awaited<ReturnType<typeof getAllPosts>> = [];
try {
  posts = await getAllPosts();
} catch (e) {
  console.warn('Could not fetch blog posts at build time:', e);
}

// ProfessionalService schema for SEO
const professionalServiceSchema = {
  '@context': 'https://schema.org',
  '@type': 'ProfessionalService',
  name: 'Growth4U',
  description: 'Especialistas en Growth Marketing para Tech B2B y B2C. Creamos motores de crecimiento basados en confianza que reducen el CAC y aumentan el LTV.',
  url: SITE_URL,
  areaServed: [
    { '@type': 'Country', name: 'Spain' },
    { '@type': 'Country', name: 'Portugal' },
    { '@type': 'GeoCircle', geoMidpoint: { '@type': 'GeoCoordinates', latitude: 40.4168, longitude: -3.7038 }, geoRadius: '2000 km' }
  ],
  serviceType: ['Growth Marketing', 'Growth Hacking', 'Customer Acquisition', 'Trust Engine'],
  knowsAbout: ['Tech', 'B2B SaaS', 'B2C Finance', 'Neobanking', 'Crypto', 'Payments'],
};

// FAQPage schema
const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: '¿Qué es el Trust Engine de Growth4U?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'El Trust Engine es nuestra metodología propietaria que construye motores de crecimiento basados en confianza. Sustituye el gasto publicitario inflado por sistemas de confianza orgánica y viralidad estructurada, reduciendo el CAC hasta un 70%.'
      }
    },
    {
      '@type': 'Question',
      name: '¿En qué etapa de crecimiento me podéis ayudar?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Ayudamos empresas tech en 3 etapas: Buscando PMF (0 a tracción real), Escalando (10K a 500K usuarios), y Expansión (nuevo mercado o producto). Cada etapa tiene su propia estrategia y garantías.'
      }
    },
    {
      '@type': 'Question',
      name: '¿Qué resultados puedo esperar?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Nuestros clientes han logrado resultados como 500K usuarios activos en 30 meses (BNEXT), reducción del 70% en CAC (BIT2ME), y 10K€ MRR en 6 meses desde el lanzamiento (GoCardless).'
      }
    },
    {
      '@type': 'Question',
      name: '¿Cuánto cuesta contratar una agencia de growth marketing para empresas tech en España?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'El coste depende de la etapa de tu empresa tech. Para startups buscando PMF, trabajamos con sprints de validación. Para empresas tech en fase de escalado (10K-500K usuarios), implementamos el Trust Engine completo. Contacta con nosotros para una propuesta personalizada basada en tus KPIs.'
      }
    },
    {
      '@type': 'Question',
      name: '¿Qué es GEO (Generative Engine Optimization) y por qué es importante para empresas tech?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'GEO es la optimización para motores de respuesta generativos como ChatGPT, Perplexity y Gemini. Para empresas tech en España, GEO es clave porque cada vez más usuarios buscan recomendaciones financieras a través de IA. Posicionar tu empresa tech en estas respuestas genera confianza y reduce drásticamente el CAC.'
      }
    },
    {
      '@type': 'Question',
      name: '¿Trabajáis solo con empresas tech de España?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Nuestro mercado principal es España y Portugal, pero también ayudamos a empresas tech internacionales con su go-to-market en el mercado español e ibérico. Hemos trabajado con empresas como GoCardless en su lanzamiento en España y Portugal.'
      }
    },
    {
      '@type': 'Question',
      name: '¿Cómo reducís el CAC de una empresa tech?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Utilizamos nuestro Trust Engine: sustituimos la dependencia de paid media por sistemas de confianza orgánica. Esto incluye posicionamiento en medios de autoridad, programas de referral estructurados, automatización con IA y optimización GEO. El resultado: reducción media del 70% en CAC como demostramos con BIT2ME.'
      }
    },
    {
      '@type': 'Question',
      name: '¿Qué diferencia a Growth4U de otras agencias de marketing en España?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: 'Somos la única agencia en España especializada en growth para empresas tech. No hacemos marketing genérico: entendemos la regulación tech española (CNMV), la fricción de confianza del usuario financiero y las métricas que importan (CAC, LTV, activación). Nuestro Trust Engine es una metodología propietaria con resultados auditados.'
      }
    }
  ]
};
---

<BaseLayout
  title="Growth4U | Crece más rápido sin invertir más en marketing"
  description="Especialistas en Growth para Empresas Tech. Te ayudamos a crear un motor de crecimiento que perdura en el tiempo y reduce tu CAC apoyándonos en el valor de la confianza."
  jsonLd={[professionalServiceSchema, faqSchema]}
>
  <Navbar t={t} lang="es" bookingLink={BOOKING_LINK} />
  <HeroSection t={t} bookingLink={BOOKING_LINK} />
  <ProblemSection t={t} />
  <ResultsSection t={t} />
  <MethodologySection t={t} />
  <CaseStudies t={t} cases={t.cases.list} />
  <TeamSection t={t} />
  <BlogPreviewSection t={t} posts={posts} />
  <Footer t={t} bookingLink={BOOKING_LINK} />
  <CookieBanner client:idle />
</BaseLayout>
